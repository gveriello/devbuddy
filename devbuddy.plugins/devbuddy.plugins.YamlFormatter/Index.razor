@using devbuddy.common.Applications
@using devbuddy.plugins.YamlFormatter.Models
@inherits AppComponentBase<YamlFormatterDataModel>

<div class="container mt-4">
	<h2 class="mb-4">YAML Formatter</h2>
	<div class="row mb-4">
		<div class="col-12">
			<ul class="nav nav-tabs" id="cronTabs" role="tablist">
				<li class="nav-item" role="presentation">
					<button class="nav-link @(activeTab == "formatter" ? "active" : "")" @onclick=@(()=> activeTab = "formatter")
							id="builder-tab" type="button" role="tab" aria-controls="builder" aria-selected="@(activeTab == "formatter")">
						Generatore
					</button>
				</li>
				<li class="nav-item" role="presentation">
					<button class="nav-link @(activeTab == "saved" ? "active" : "")" @onclick=@(()=> activeTab = "saved")
							id="saved-tab" type="button" role="tab" aria-controls="saved" aria-selected="@(activeTab == "saved")">
						YAML salvati
					</button>
				</li>
			</ul>

			<div class="tab-content pt-3" id="formatterTabContent">
				<!-- Builder Tab -->
				<div class="tab-pane fade @(activeTab == "formatter" ? "show active" : "")" id="formatter" role="tabpanel" aria-labelledby="formatter-tab">
					<div class="row mb-3">
						@if (!string.IsNullOrEmpty(ErrorMessage))
						{
							<div class="alert alert-danger mt-3">
								<strong>Errore:</strong> @ErrorMessage
							</div>
						}
						<div class="col-md-5">
							<div class="card">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h5 class="mb-0">Input</h5>
									<div>
										<button class="btn btn-primary btn-sm" @onclick="PasteFromClipboard" title="Incolla dagli appunti">
											<i class="fa-solid fa-paste"></i>
										</button>
										<button class="btn btn-danger btn-sm" @onclick="ClearInput" title="Cancella tutto">
											<i class="fa-solid fa-eraser"></i>
										</button>
									</div>
								</div>
								<div class="card-body">
									<textarea @bind="InputYaml" @bind:event="oninput" @onkeyup="FormatYaml"
											  class="form-control" rows="15" placeholder="Inserisci qui il tuo YAML" style="font-family: monospace;"></textarea>
								</div>
							</div>
						</div>

						<div class="col-md-5">
							<div class="card">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h5 class="mb-0">Output</h5>
									<div>
										<button class="btn btn-secondary btn-sm" @onclick="CopyToClipboard" title="Copia negli appunti">
											<i class="fa-solid fa-copy"></i>
										</button>
										<button class="btn btn-success btn-sm" @onclick="ShowSaveDialog" title="Salva questo YAML">
											<i class="fa-solid fa-floppy-disk"></i>
										</button>
									</div>
								</div>
								<div class="card-body">
									<textarea @bind="OutputYaml" class="form-control" rows="15" readonly style="font-family: monospace;"></textarea>
									<div class="mt-2 text-muted small">
										<span title="Dimensione in caratteri">Dimensione: @YamlSize caratteri</span> |
										<span title="Numero di linee">Linee: @YamlLines</span> |
										<span title="Numero di nodi">Nodi: @YamlNodes</span>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-2">
							<div class="card">
								<div class="card-header">
									<h5 class="mb-0">Opzioni</h5>
								</div>
								<div class="card-body">
									<div class="row">
										<div class="col-md-4">
											@* <div class="row">
												<div class="col-md-12">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="autoFormat" @bind="AutoFormat">
														<label class="form-check-label" for="autoFormat">
															Formattazione automatica
														</label><br />
													</div>
												</div>
											</div> *@

											<div class="row">
												<div class="col-md-12">
													<div class="form-check">
														<input class="form-check-input" type="checkbox" id="minify" @bind="Minify" @bind:after="FormatYaml">
														<label class="form-check-label" for="minify">
															Minify (compatta)
														</label>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="tab-pane fade @(activeTab == "saved" ? "show active" : "")" id="saved" role="tabpanel" aria-labelledby="saved-tab">
					<div class="row mt-4">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header d-flex justify-content-between align-items-center">
									<h5 class="mb-0">YAML salvati</h5>
								</div>
								<div class="card-body">
									@if (Model.SavedYamls.Count > 0)
									{
										<div class="table-responsive">
											<table class="table table-bordered table-striped">
												<thead>
													<tr>
														<th>Nome</th>
														<th>Descrizione</th>
														<th>Data creazione</th>
														<th>Azioni</th>
													</tr>
												</thead>
												<tbody>
													@foreach (var yaml in Model.SavedYamls.OrderByDescending(y => y.CreatedDate))
													{
														<tr>
															<td>@yaml.Name</td>
															<td>@yaml.Description</td>
															<td>@yaml.CreatedDate.ToString("dd/MM/yyyy HH:mm")</td>
															<td>
																<button class="btn btn-sm btn-primary me-1" @onclick="() => LoadSavedYaml(yaml)" title="Carica">
																	<i class="fa-solid fa-upload"></i>
																</button>
																<button class="btn btn-sm btn-danger" @onclick="() => DeleteSavedYaml(yaml)" title="Elimina">
																	<i class="fa-solid fa-trash"></i>
																</button>
															</td>
														</tr>
													}
												</tbody>
											</table>
										</div>
									}
									else
									{
										<div class="alert alert-info">
											Non hai ancora salvato nessuno YAML. Utilizza il pulsante "Salva" nella sezione di output.
										</div>
									}
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Save YAML Modal -->
<ModalComponentBase @ref="saveModal" Title="Salva YAML" ModalSize="modal-lg" OnConfirmCallback="SaveYaml">
	<div class="mb-3">
		<label for="yamlName" class="form-label">Nome *</label>
		<input type="text" class="form-control" id="yamlName" placeholder="Inserisci un nome per questo YAML" @bind="SaveYamlName" />
	</div>
	<div class="mb-3">
		<label for="yamlDescription" class="form-label">Descrizione</label>
		<textarea class="form-control" id="yamlDescription" rows="3" placeholder="Descrivi a cosa serve questo YAML" @bind="SaveYamlDescription"></textarea>
	</div>
</ModalComponentBase>

<!-- Delete Confirmation Modal -->
<ModalComponentBase @ref="deleteModal" Title="Conferma eliminazione" ModalSize="modal-md" OnConfirmCallback="ConfirmDeleteYaml">
	<p>Sei sicuro di voler eliminare il YAML "@(yamlToDelete?.Name)"?</p>
	<p>Questa azione non pu&ograve; essere annullata.</p>
</ModalComponentBase>
